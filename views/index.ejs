<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pro Chat</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<style>
/* Smooth message pop animation */
@keyframes pop {
  from { transform: scale(0.9); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}

.message {
  animation: pop .2s ease-out;
}

/* typing dots */
.typing span {
  animation: blink 1.4s infinite both;
}
.typing span:nth-child(2){animation-delay:.2s}
.typing span:nth-child(3){animation-delay:.4s}

@keyframes blink {
  0% {opacity:.2}
  20% {opacity:1}
  100% {opacity:.2}
}
</style>


<body class="bg-gray-900 text-gray-100 h-screen flex">

<!-- Sidebar -->
<div class="w-72 bg-gray-800 border-r border-gray-700 flex flex-col">
  <div class="p-4 text-xl font-semibold border-b border-gray-700">
    ðŸ’¬ Live Chat
  </div>

  <ul id="users" class="flex-1 overflow-y-auto p-3 space-y-2"></ul>
</div>

<!-- Chat Area -->
<div class="flex-1 flex flex-col">

  <!-- Messages -->
  <div id="chat" class="flex-1 overflow-y-auto p-6 space-y-4"></div>

  <!-- Input -->
  <form id="message-form" class="p-4 border-t border-gray-700 bg-gray-800 flex gap-3">
    <input 
      id="message-input"
      type="text"
      placeholder="Type your message..."
      class="flex-1 bg-gray-700 rounded-xl px-4 py-2 outline-none focus:ring-2 focus:ring-blue-500"
      required
    />
    <button 
      class="bg-blue-600 hover:bg-blue-700 px-5 py-2 rounded-xl font-medium transition">
      Send
    </button>
  </form>

</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();

const chat = document.getElementById("chat");
const usersList = document.getElementById("users");
const messageForm = document.getElementById("message-form");
const messageInput = document.getElementById("message-input");

const userName = prompt("Enter your username");
socket.emit("join", userName);

let typingTimeout;

/* User list */
socket.on("userList", users => {
  usersList.innerHTML = users.map(user => `
    <li class="flex items-center gap-2 bg-gray-700 px-3 py-2 rounded-lg">
      <span class="w-2 h-2 bg-green-400 rounded-full"></span>
      ${user}
    </li>
  `).join("");
});

/* Typing indicator */
messageInput.addEventListener("input", () => {
  socket.emit("typing", userName);

  clearTimeout(typingTimeout);
  typingTimeout = setTimeout(() => {
    socket.emit("stopTyping", userName);
  }, 1000);
});

socket.on("typing", user => showTyping(user));
socket.on("stopTyping", () => removeTyping());

/* Messages */
socket.on("chatMessage", msg => {
  addMessage(msg.userName, msg.text);
});

/* Join/Leave */
socket.on("userJoined", user => systemMessage(`${user} joined`));
socket.on("userLeft", user => systemMessage(`${user} left`));

messageForm.addEventListener("submit", e => {
  e.preventDefault();
  const text = messageInput.value.trim();
  if(!text) return;

  socket.emit("chatMessage", { userName, text });
  socket.emit("stopTyping");

  messageInput.value = "";
});

/* UI helpers */
function addMessage(sender, text){
  const isMe = sender === userName;
  const msg = document.createElement("div");

  msg.className = `flex message ${isMe ? "justify-end" : "justify-start"}`;

  msg.innerHTML = `
    <div class="max-w-xs px-4 py-2 rounded-xl ${
      isMe ? "bg-blue-600" : "bg-gray-700"
    }">
      <div class="text-sm font-semibold mb-1">${sender}</div>
      ${text}
    </div>
  `;

  chat.appendChild(msg);
  removeTyping();
  chat.scrollTop = chat.scrollHeight;
}

function systemMessage(text){
  const msg = document.createElement("div");
  msg.className = "text-center text-gray-400 text-sm";
  msg.textContent = text;
  chat.appendChild(msg);
}

function showTyping(user){
  if(document.getElementById("typing")) return;

  const el = document.createElement("div");
  el.id = "typing";
  el.className = "typing text-gray-400 text-sm";

  el.innerHTML = `${user} is typing <span>.</span><span>.</span><span>.</span>`;

  chat.appendChild(el);
  chat.scrollTop = chat.scrollHeight;
}

function removeTyping(){
  const el = document.getElementById("typing");
  if(el) el.remove();
}
</script>

</body>
</html>
